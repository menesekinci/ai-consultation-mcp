<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Consultation MCP - Configuration</title>

  <!-- Geist Font - Vercel's distinctive typeface -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&family=Geist+Mono:wght@400;500&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.socket.io/4.8.0/socket.io.min.js"></script>
  <script defer src="https://unpkg.com/alpinejs@3.14.8/dist/cdn.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Geist', 'system-ui', 'sans-serif'],
            mono: ['Geist Mono', 'monospace'],
          },
          colors: {
            // Custom dark theme with amber/orange accent
            surface: {
              DEFAULT: '#0c0c0c',
              50: '#171717',
              100: '#1a1a1a',
              200: '#262626',
              300: '#404040',
            },
            accent: {
              DEFAULT: '#f59e0b',
              50: '#fffbeb',
              100: '#fef3c7',
              200: '#fde68a',
              300: '#fcd34d',
              400: '#fbbf24',
              500: '#f59e0b',
              600: '#d97706',
              700: '#b45309',
              800: '#92400e',
              900: '#78350f',
            },
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out forwards',
            'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
            'slide-in': 'slideIn 0.4s ease-out forwards',
            'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
            'float': 'float 6s ease-in-out infinite',
            'float-slow': 'floatSlow 20s ease-in-out infinite',
            'float-medium': 'floatMedium 15s ease-in-out infinite',
            'float-fast': 'floatFast 12s ease-in-out infinite',
            'spin-slow': 'spinSlow 30s linear infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            fadeInUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            slideIn: {
              '0%': { opacity: '0', transform: 'translateX(-10px)' },
              '100%': { opacity: '1', transform: 'translateX(0)' },
            },
            pulseGlow: {
              '0%, 100%': { boxShadow: '0 0 20px rgba(245, 158, 11, 0.1)' },
              '50%': { boxShadow: '0 0 40px rgba(245, 158, 11, 0.2)' },
            },
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-10px)' },
            },
            floatSlow: {
              '0%': { transform: 'translate(0, 0) rotate(0deg)' },
              '25%': { transform: 'translate(30px, -40px) rotate(90deg)' },
              '50%': { transform: 'translate(-20px, -60px) rotate(180deg)' },
              '75%': { transform: 'translate(-40px, -20px) rotate(270deg)' },
              '100%': { transform: 'translate(0, 0) rotate(360deg)' },
            },
            floatMedium: {
              '0%': { transform: 'translate(0, 0) rotate(0deg)' },
              '33%': { transform: 'translate(-50px, 30px) rotate(120deg)' },
              '66%': { transform: 'translate(40px, -30px) rotate(240deg)' },
              '100%': { transform: 'translate(0, 0) rotate(360deg)' },
            },
            floatFast: {
              '0%': { transform: 'translate(0, 0) rotate(0deg)' },
              '50%': { transform: 'translate(60px, 40px) rotate(180deg)' },
              '100%': { transform: 'translate(0, 0) rotate(360deg)' },
            },
            spinSlow: {
              '0%': { transform: 'rotate(0deg)' },
              '100%': { transform: 'rotate(360deg)' },
            },
          },
        }
      }
    }
  </script>
  <style>
    [x-cloak] { display: none !important; }

    /* Noise texture overlay */
    .noise-bg::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }

    /* Gradient mesh background */
    .gradient-mesh {
      background:
        radial-gradient(ellipse at 20% 0%, rgba(245, 158, 11, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(217, 119, 6, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(180, 83, 9, 0.04) 0%, transparent 70%);
    }

    /* Glassmorphism card */
    .glass-card {
      background: rgba(23, 23, 23, 0.6);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .glass-card:hover {
      background: rgba(26, 26, 26, 0.8);
      border-color: rgba(245, 158, 11, 0.2);
      box-shadow: 0 0 30px rgba(245, 158, 11, 0.08);
    }

    /* Staggered animation delays */
    .stagger-1 { animation-delay: 0.1s; }
    .stagger-2 { animation-delay: 0.2s; }
    .stagger-3 { animation-delay: 0.3s; }
    .stagger-4 { animation-delay: 0.4s; }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #0c0c0c;
    }
    ::-webkit-scrollbar-thumb {
      background: #404040;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #525252;
    }

    /* Input focus glow */
    input:focus, select:focus {
      box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
    }

    /* Button hover glow */
    .btn-accent:hover {
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
    }

    /* Line clamp for card preview */
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Floating geometric shapes */
    .floating-shapes {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .floating-shape {
      position: absolute;
      opacity: 0.04;
      will-change: transform;
    }

    .floating-shape.accent {
      opacity: 0.06;
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      .floating-shape {
        animation: none !important;
      }
    }

    /* Card relative positioning for hover effect */
    .glass-card {
      position: relative;
    }
  </style>
</head>
<body class="bg-surface text-neutral-100 min-h-screen font-sans noise-bg gradient-mesh">
  <!-- Floating Geometric Shapes Background -->
  <div class="floating-shapes">
    <!-- Squares -->
    <svg class="floating-shape animate-float-slow" style="top: 10%; left: 5%; width: 40px; height: 40px;">
      <rect width="40" height="40" fill="currentColor" class="text-accent-500"/>
    </svg>
    <svg class="floating-shape animate-float-medium" style="top: 60%; left: 15%; width: 25px; height: 25px;">
      <rect width="25" height="25" fill="currentColor" class="text-neutral-400"/>
    </svg>
    <svg class="floating-shape animate-float-fast" style="top: 30%; right: 10%; width: 35px; height: 35px;">
      <rect width="35" height="35" fill="currentColor" class="text-accent-400" rx="4"/>
    </svg>

    <!-- Circles -->
    <svg class="floating-shape animate-float-medium" style="top: 20%; right: 20%; width: 50px; height: 50px;">
      <circle cx="25" cy="25" r="25" fill="currentColor" class="text-accent-500"/>
    </svg>
    <svg class="floating-shape animate-float-slow" style="top: 75%; left: 25%; width: 30px; height: 30px;">
      <circle cx="15" cy="15" r="15" fill="currentColor" class="text-neutral-500"/>
    </svg>
    <svg class="floating-shape animate-float-fast" style="top: 45%; right: 5%; width: 20px; height: 20px;">
      <circle cx="10" cy="10" r="10" fill="currentColor" class="text-accent-400"/>
    </svg>

    <!-- Triangles -->
    <svg class="floating-shape animate-float-fast" style="top: 15%; left: 40%; width: 35px; height: 35px;">
      <polygon points="17.5,0 35,35 0,35" fill="currentColor" class="text-accent-500"/>
    </svg>
    <svg class="floating-shape animate-float-slow" style="top: 80%; right: 30%; width: 45px; height: 45px;">
      <polygon points="22.5,0 45,45 0,45" fill="currentColor" class="text-neutral-400"/>
    </svg>

    <!-- Hexagons -->
    <svg class="floating-shape animate-float-medium accent" style="top: 5%; right: 35%; width: 40px; height: 40px;">
      <polygon points="20,0 40,10 40,30 20,40 0,30 0,10" fill="currentColor" class="text-accent-500"/>
    </svg>
    <svg class="floating-shape animate-float-fast" style="top: 55%; left: 8%; width: 30px; height: 30px;">
      <polygon points="15,0 30,7.5 30,22.5 15,30 0,22.5 0,7.5" fill="currentColor" class="text-neutral-500"/>
    </svg>

    <!-- Diamonds -->
    <svg class="floating-shape animate-float-slow" style="top: 35%; left: 20%; width: 30px; height: 30px;">
      <polygon points="15,0 30,15 15,30 0,15" fill="currentColor" class="text-accent-400"/>
    </svg>
    <svg class="floating-shape animate-float-medium" style="top: 70%; right: 15%; width: 25px; height: 25px;">
      <polygon points="12.5,0 25,12.5 12.5,25 0,12.5" fill="currentColor" class="text-neutral-400"/>
    </svg>

    <!-- Pentagons -->
    <svg class="floating-shape animate-float-fast accent" style="top: 90%; left: 50%; width: 35px; height: 35px;">
      <polygon points="17.5,0 35,13 28,35 7,35 0,13" fill="currentColor" class="text-accent-500"/>
    </svg>
    <svg class="floating-shape animate-float-slow" style="top: 25%; right: 40%; width: 28px; height: 28px;">
      <polygon points="14,0 28,10.4 22.4,28 5.6,28 0,10.4" fill="currentColor" class="text-neutral-500"/>
    </svg>
  </div>

  <div x-data="configApp()" x-init="init()" x-cloak class="max-w-5xl mx-auto px-6 py-12 relative z-10">

    <!-- Header -->
    <header class="mb-8 opacity-0 animate-fade-in-up">
      <div class="flex items-center justify-center mb-4">
        <div class="relative">
          <!-- Animated glow ring -->
          <div class="absolute inset-0 bg-accent-500/20 rounded-full blur-xl animate-pulse-glow"></div>
          <div class="relative w-16 h-16 bg-gradient-to-br from-accent-400 to-accent-600 rounded-2xl flex items-center justify-center transform hover:rotate-12 transition-transform duration-500">
            <svg class="w-8 h-8 text-surface" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
        </div>
      </div>
      <h1 class="text-4xl md:text-5xl font-bold text-center tracking-tight">
        <span class="bg-gradient-to-r from-neutral-100 via-neutral-200 to-neutral-400 bg-clip-text text-transparent">
          Agent Consultation
        </span>
        <span class="text-accent-500"> MCP</span>
      </h1>
      <p class="text-neutral-500 text-center mt-3 text-lg">Enabling agents to get a second opinion</p>

      <!-- Connection Status Indicator -->
      <div class="flex items-center justify-center mt-4 gap-4">
        <div class="flex items-center gap-2 px-3 py-1.5 bg-surface-50/50 rounded-full border border-surface-200/50">
          <span
            class="w-2 h-2 rounded-full"
            :class="connected ? 'bg-emerald-500 animate-pulse' : 'bg-red-500'"
          ></span>
          <span class="text-xs font-medium" :class="connected ? 'text-emerald-400' : 'text-red-400'" x-text="connected ? 'Connected' : 'Disconnected'"></span>
        </div>
        <template x-if="connected && clientCount > 0">
          <div class="flex items-center gap-1.5 px-3 py-1.5 bg-surface-50/50 rounded-full border border-surface-200/50">
            <svg class="w-3.5 h-3.5 text-accent-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
            </svg>
            <span class="text-xs font-medium text-accent-400" x-text="clientCount + ' client' + (clientCount > 1 ? 's' : '')"></span>
          </div>
        </template>
      </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="mb-8 opacity-0 animate-fade-in-up stagger-1">
      <div class="flex justify-center">
        <div class="inline-flex bg-surface-50/50 p-1 rounded-xl border border-surface-200/50">
          <button
            @click="activeTab = 'config'"
            :class="activeTab === 'config'
              ? 'bg-accent-500 text-surface shadow-lg'
              : 'text-neutral-400 hover:text-neutral-200 hover:bg-surface-200/50'"
            class="flex items-center px-5 py-2.5 rounded-lg font-medium text-sm transition-all duration-300"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            Config
          </button>
          <button
            @click="activeTab = 'archive'"
            :class="activeTab === 'archive'
              ? 'bg-accent-500 text-surface shadow-lg'
              : 'text-neutral-400 hover:text-neutral-200 hover:bg-surface-200/50'"
            class="flex items-center px-5 py-2.5 rounded-lg font-medium text-sm transition-all duration-300"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
            Archive
            <span
              x-show="historyStats.active + historyStats.archived > 0"
              class="ml-2 px-1.5 py-0.5 text-[10px] rounded-full"
              :class="activeTab === 'archive' ? 'bg-surface/30 text-surface' : 'bg-accent-500/20 text-accent-400'"
              x-text="historyStats.active + historyStats.archived"
            ></span>
          </button>
          <button
            @click="activeTab = 'rag'"
            :class="activeTab === 'rag'
              ? 'bg-accent-500 text-surface shadow-lg'
              : 'text-neutral-400 hover:text-neutral-200 hover:bg-surface-200/50'"
            class="flex items-center px-5 py-2.5 rounded-lg font-medium text-sm transition-all duration-300"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            RAG / Memory
          </button>
          <button
            @click="activeTab = 'readme'"
            :class="activeTab === 'readme'
              ? 'bg-accent-500 text-surface shadow-lg'
              : 'text-neutral-400 hover:text-neutral-200 hover:bg-surface-200/50'"
            class="flex items-center px-5 py-2.5 rounded-lg font-medium text-sm transition-all duration-300"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
            </svg>
            Readme
          </button>
        </div>
      </div>
    </nav>

    <!-- Toast Notifications (z-[60] to appear above modal z-50) -->
    <div class="fixed top-6 right-6 z-[60] space-y-3">
      <template x-for="toast in toasts" :key="toast.id">
        <div
          x-show="toast.show"
          x-transition:enter="transition ease-out duration-300"
          x-transition:enter-start="opacity-0 transform translate-x-8 scale-95"
          x-transition:enter-end="opacity-100 transform translate-x-0 scale-100"
          x-transition:leave="transition ease-in duration-200"
          x-transition:leave-start="opacity-100 scale-100"
          x-transition:leave-end="opacity-0 scale-95"
          :class="{
            'bg-emerald-500/20 border-emerald-500/30 text-emerald-300': toast.type === 'success',
            'bg-red-500/20 border-red-500/30 text-red-300': toast.type === 'error',
            'bg-accent-500/20 border-accent-500/30 text-accent-300': toast.type === 'info'
          }"
          class="px-5 py-3 rounded-xl border backdrop-blur-md shadow-2xl flex items-center space-x-3 font-medium"
        >
          <template x-if="toast.type === 'success'">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
          </template>
          <template x-if="toast.type === 'error'">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </template>
          <template x-if="toast.type === 'info'">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </template>
          <span x-text="toast.message"></span>
        </div>
      </template>
    </div>

    <!-- Loading State -->
    <div x-show="loading" class="flex flex-col items-center justify-center py-32">
      <div class="relative">
        <div class="absolute inset-0 bg-accent-500/20 rounded-full blur-2xl animate-pulse"></div>
        <div class="relative w-16 h-16 border-4 border-surface-200 border-t-accent-500 rounded-full animate-spin"></div>
      </div>
      <p class="mt-6 text-neutral-500 font-medium">Loading configuration...</p>
    </div>

    <!-- Error State -->
    <div x-show="!loading && loadError" class="flex flex-col items-center justify-center py-32 opacity-0 animate-fade-in-up">
      <div class="relative">
        <div class="absolute inset-0 bg-red-500/10 rounded-full blur-2xl"></div>
        <div class="relative w-20 h-20 bg-red-500/10 rounded-2xl flex items-center justify-center border border-red-500/20">
          <svg class="w-10 h-10 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
        </div>
      </div>
      <h3 class="text-2xl font-semibold text-neutral-100 mt-6">Connection Failed</h3>
      <p class="text-neutral-500 mt-2 text-center max-w-md" x-text="loadError"></p>
      <button
        @click="loading = true; loadError = null; init()"
        class="mt-6 px-6 py-3 bg-accent-600 hover:bg-accent-500 rounded-xl font-semibold transition-all duration-300 btn-accent"
      >
        Try Again
      </button>
    </div>

    <!-- Main Content -->
    <div x-show="!loading && !loadError" class="space-y-12">

      <!-- CONFIG TAB -->
      <div x-show="activeTab === 'config'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">

      <!-- Providers Section -->
      <section>
        <div class="flex items-center mb-6">
          <h2 class="text-2xl font-semibold flex items-center">
            <div class="w-10 h-10 bg-accent-500/10 rounded-xl flex items-center justify-center mr-3">
              <svg class="w-5 h-5 text-accent-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              </svg>
            </div>
            API Providers
          </h2>
        </div>

        <!-- Provider Cards Grid -->
        <div class="grid gap-4 md:grid-cols-2 mb-8">
          <template x-for="provider in providers" :key="provider.id">
            <div class="glass-card rounded-2xl p-5 transition-all duration-300">
              <!-- Provider Header -->
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                  <div
                    class="w-10 h-10 rounded-xl flex items-center justify-center mr-3 border"
                    :class="provider.id === 'deepseek'
                      ? 'bg-gradient-to-br from-blue-500/20 to-purple-500/20 border-blue-500/20'
                      : 'bg-gradient-to-br from-emerald-500/20 to-teal-500/20 border-emerald-500/20'"
                  >
                    <svg class="w-5 h-5" :class="provider.id === 'deepseek' ? 'text-blue-400' : 'text-emerald-400'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                  </div>
                  <div>
                    <h3 class="text-base font-semibold text-neutral-100" x-text="provider.name"></h3>
                    <p class="text-xs text-neutral-500" x-text="provider.description"></p>
                  </div>
                </div>
                <div
                  class="flex items-center px-2 py-1 rounded-lg"
                  :class="provider.hasKey ? 'bg-emerald-500/10 border border-emerald-500/20' : 'bg-red-500/10 border border-red-500/20'"
                >
                  <div class="w-1.5 h-1.5 rounded-full mr-1.5" :class="provider.hasKey ? 'bg-emerald-400' : 'bg-red-400'"></div>
                  <span class="text-[10px] font-medium" :class="provider.hasKey ? 'text-emerald-400' : 'text-red-400'" x-text="provider.hasKey ? 'Connected' : 'Not Set'"></span>
                </div>
              </div>

              <!-- API Key Status -->
              <template x-if="provider.hasKey">
                <div class="flex items-center text-xs bg-surface-50/50 rounded-lg px-3 py-2 mb-4">
                  <svg class="w-3 h-3 text-emerald-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
                  </svg>
                  <code class="text-emerald-400 font-mono text-[11px]" x-text="provider.maskedKey"></code>
                </div>
              </template>

              <!-- Models List -->
              <div class="flex flex-wrap gap-1.5 mb-4">
                <template x-for="model in provider.models" :key="model.id">
                  <span class="text-[10px] px-2 py-1 bg-surface-200/50 text-neutral-400 rounded font-mono" x-text="model.name"></span>
                </template>
              </div>

              <!-- Action Buttons -->
              <div class="flex items-center gap-2">
                <button
                  @click="openKeyModal(provider)"
                  class="flex-1 px-3 py-2 bg-accent-600 hover:bg-accent-500 rounded-lg text-xs font-semibold transition-all duration-300 btn-accent"
                  x-text="provider.hasKey ? 'Update Key' : 'Add API Key'"
                ></button>
                <template x-if="provider.hasKey">
                  <button
                    @click="testKey(provider.id)"
                    :disabled="testing === provider.id"
                    class="px-3 py-2 bg-surface-200 hover:bg-surface-300 rounded-lg text-xs font-medium transition-all duration-300 disabled:opacity-50"
                  >
                    <span x-show="testing !== provider.id">Test</span>
                    <svg x-show="testing === provider.id" class="animate-spin h-3 w-3" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                  </button>
                </template>
                <template x-if="provider.hasKey">
                  <button
                    @click="removeKey(provider.id)"
                    class="px-2 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-xs font-medium transition-all duration-300 border border-red-500/20"
                    title="Remove API Key"
                  >
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                  </button>
                </template>
              </div>
            </div>
          </template>
        </div>

        <!-- Settings Section -->
        <div class="glass-card rounded-2xl p-6 mt-8">
          <h3 class="text-lg font-semibold text-neutral-100 mb-4">Settings</h3>
          <div class="grid gap-5 md:grid-cols-2">
            <!-- Default Model -->
            <div>
              <label class="block text-xs font-medium text-neutral-500 mb-2 uppercase tracking-wider">Default Model</label>
              <select
                x-model="config.defaultModel"
                @change="saveConfig()"
                class="w-full bg-surface-100 border border-surface-300 rounded-xl px-4 py-3 text-neutral-100 focus:ring-2 focus:ring-accent-500/50 focus:border-accent-500 transition-all duration-300 font-mono text-sm appearance-none cursor-pointer"
                style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 24 24%27 stroke=%27%23737373%27%3E%3Cpath stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%272%27 d=%27M19 9l-7 7-7-7%27/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1rem;"
              >
                <template x-for="model in config.availableModels" :key="model">
                  <option :value="model" x-text="model"></option>
                </template>
              </select>
            </div>

            <!-- Max Messages -->
            <div>
              <label class="block text-xs font-medium text-neutral-500 mb-2 uppercase tracking-wider">Max Messages</label>
              <input
                type="number"
                x-model="config.maxMessages"
                @change="saveConfig()"
                min="1"
                max="50"
                class="w-full bg-surface-100 border border-surface-300 rounded-xl px-4 py-3 text-neutral-100 focus:ring-2 focus:ring-accent-500/50 focus:border-accent-500 transition-all duration-300 font-mono text-sm"
              />
            </div>

            <!-- Request Timeout -->
            <div>
              <label class="block text-xs font-medium text-neutral-500 mb-2 uppercase tracking-wider">Request Timeout</label>
              <div class="relative">
                <select
                  x-model="config.requestTimeout"
                  @change="saveConfig()"
                  class="w-full bg-surface-100 border border-surface-300 rounded-xl px-4 py-3 text-neutral-100 focus:ring-2 focus:ring-accent-500/50 focus:border-accent-500 transition-all duration-300 font-mono text-sm appearance-none cursor-pointer"
                  style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 fill=%27none%27 viewBox=%270 0 24 24%27 stroke=%27%23737373%27%3E%3Cpath stroke-linecap=%27round%27 stroke-linejoin=%27round%27 stroke-width=%272%27 d=%27M19 9l-7 7-7-7%27/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1rem;"
                >
                  <option value="60000">1 minute</option>
                  <option value="120000">2 minutes</option>
                  <option value="180000">3 minutes (default)</option>
                  <option value="300000">5 minutes</option>
                  <option value="600000">10 minutes</option>
                </select>
              </div>
              <p class="text-xs text-neutral-600 mt-1">Max wait time for AI response</p>
            </div>

            <!-- Auto Open Web UI Toggle -->
            <div class="md:col-span-2">
              <div class="flex items-center justify-between p-4 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-accent-500/10 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-accent-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                    </svg>
                  </div>
                  <div>
                    <h4 class="font-medium text-neutral-200 text-sm">Auto-open Web UI</h4>
                    <p class="text-xs text-neutral-500">Automatically open this dashboard when an agent uses consultation tools</p>
                  </div>
                </div>
                <button
                  @click="config.autoOpenWebUI = !config.autoOpenWebUI; saveConfig()"
                  :class="config.autoOpenWebUI ? 'bg-accent-500' : 'bg-surface-300'"
                  class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-accent-500 focus:ring-offset-2 focus:ring-offset-surface"
                >
                  <span
                    :class="config.autoOpenWebUI ? 'translate-x-5' : 'translate-x-0'"
                    class="pointer-events-none inline-block h-6 w-6 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                  ></span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      </div><!-- END CONFIG TAB -->

      <!-- ARCHIVE TAB -->
      <div x-show="activeTab === 'archive'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">

      <!-- Conversation History Section -->
      <section>
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center">
            <div class="w-10 h-10 bg-accent-500/10 rounded-xl flex items-center justify-center mr-3">
              <svg class="w-5 h-5 text-accent-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
            </div>
            <div>
              <h2 class="text-2xl font-semibold">Conversation History</h2>
              <div class="flex items-center gap-3 mt-1">
                <span class="text-xs text-emerald-400" x-text="historyStats.active + ' active'"></span>
                <span class="text-xs text-neutral-500">|</span>
                <span class="text-xs text-neutral-400" x-text="historyStats.archived + ' archived'"></span>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <!-- Delete All Archived Button -->
            <template x-if="historyStats.archived > 0">
              <button
                @click="deleteAllArchived()"
                class="px-4 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-xl text-sm font-medium transition-all duration-300 flex items-center"
              >
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
                Delete Archived
              </button>
            </template>
            <!-- Refresh Button -->
            <button
              @click="loadChatHistory()"
              :disabled="loadingHistory"
              class="px-4 py-2 bg-surface-200 hover:bg-surface-300 rounded-xl text-sm font-medium transition-all duration-300 disabled:opacity-50 flex items-center"
            >
              <svg x-show="!loadingHistory" class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
              <svg x-show="loadingHistory" class="animate-spin w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Refresh
            </button>
          </div>
        </div>

        <!-- Empty State -->
        <template x-if="!loadingHistory && chatHistory.length === 0">
          <div class="glass-card rounded-2xl p-8 text-center">
            <div class="w-16 h-16 bg-surface-200/50 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-neutral-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
            </div>
            <h3 class="text-lg font-semibold text-neutral-300 mb-2">No Active Conversations</h3>
            <p class="text-neutral-500 text-sm">AI consultation conversations will appear here.</p>
          </div>
        </template>

        <!-- Conversations Card Grid -->
        <div x-show="chatHistory.length > 0">
          <!-- Card Grid -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 mb-6">
            <template x-for="conv in paginatedHistory" :key="conv.id">
              <div
                @click="openConversationModal(conv)"
                class="glass-card rounded-xl p-4 cursor-pointer transition-all duration-300 hover:scale-[1.02] hover:border-accent-500/40 group"
                :class="conv.status === 'archived' ? 'opacity-80' : ''"
              >
                <!-- Card Header: Status + Model -->
                <div class="flex items-center justify-between mb-3">
                  <span
                    class="px-2 py-0.5 rounded text-[10px] font-semibold uppercase tracking-wide"
                    :class="conv.status === 'active'
                      ? 'bg-emerald-500/20 text-emerald-400'
                      : 'bg-neutral-500/20 text-neutral-400'"
                    x-text="conv.status === 'active' ? 'Active' : 'Archived'"
                  ></span>
                  <template x-if="conv.status === 'archived' && conv.endReason">
                    <span
                      class="px-2 py-0.5 rounded text-[10px] font-medium"
                      :class="conv.endReason === 'completed'
                        ? 'bg-blue-500/20 text-blue-400'
                        : 'bg-orange-500/20 text-orange-400'"
                      x-text="conv.endReason === 'completed' ? 'Done' : 'Timeout'"
                    ></span>
                  </template>
                </div>

                <!-- Model Badge -->
                <div class="mb-3">
                  <span class="px-2 py-1 bg-accent-500/15 text-accent-400 rounded text-xs font-mono" x-text="conv.model"></span>
                </div>

                <!-- Message Preview -->
                <div class="mb-3 min-h-[60px]">
                  <p class="text-xs text-neutral-400 line-clamp-3" x-text="conv.messages[0]?.content.substring(0, 100) + (conv.messages[0]?.content.length > 100 ? '...' : '') || 'No messages'"></p>
                </div>

                <!-- Card Footer: Stats -->
                <div class="flex items-center justify-between pt-3 border-t border-surface-300/20">
                  <div class="flex items-center text-neutral-500">
                    <svg class="w-3.5 h-3.5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                    <span class="text-[11px]" x-text="conv.messageCount"></span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-[10px] text-neutral-600" x-text="new Date(conv.createdAt).toLocaleDateString()"></span>
                    <!-- Delete button for archived conversations -->
                    <template x-if="conv.status === 'archived'">
                      <button
                        @click.stop="deleteConversation(conv.id)"
                        class="p-1 rounded hover:bg-red-500/20 text-neutral-500 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100"
                        title="Delete conversation"
                      >
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                      </button>
                    </template>
                  </div>
                </div>

                <!-- Hover indicator -->
                <div class="absolute inset-0 rounded-xl border-2 border-transparent group-hover:border-accent-500/20 transition-all duration-300 pointer-events-none"></div>
              </div>
            </template>
          </div>

          <!-- Pagination Controls -->
          <div class="flex items-center justify-between glass-card rounded-xl px-4 py-3">
            <div class="text-sm text-neutral-500">
              <span x-text="'Showing ' + ((currentPage - 1) * itemsPerPage + 1) + '-' + Math.min(currentPage * itemsPerPage, chatHistory.length) + ' of ' + chatHistory.length"></span>
            </div>
            <div class="flex items-center gap-2">
              <!-- Previous Button -->
              <button
                @click="prevPage()"
                :disabled="currentPage === 1"
                class="px-3 py-1.5 bg-surface-200 hover:bg-surface-300 rounded-lg text-sm font-medium transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
              </button>

              <!-- Page Numbers -->
              <div class="flex items-center gap-1">
                <template x-for="page in totalPages" :key="page">
                  <button
                    x-show="page === 1 || page === totalPages || (page >= currentPage - 1 && page <= currentPage + 1)"
                    @click="goToPage(page)"
                    class="w-8 h-8 rounded-lg text-sm font-medium transition-all duration-200"
                    :class="page === currentPage
                      ? 'bg-accent-500 text-surface'
                      : 'bg-surface-200 hover:bg-surface-300 text-neutral-300'"
                    x-text="page"
                  ></button>
                </template>
              </div>

              <!-- Next Button -->
              <button
                @click="nextPage()"
                :disabled="currentPage === totalPages"
                class="px-3 py-1.5 bg-surface-200 hover:bg-surface-300 rounded-lg text-sm font-medium transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </section>

      </div><!-- END ARCHIVE TAB -->

      <!-- RAG TAB -->
      <div x-show="activeTab === 'rag'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
        <section>
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center">
              <div class="w-10 h-10 bg-accent-500/10 rounded-xl flex items-center justify-center mr-3">
                <svg class="w-5 h-5 text-accent-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
              </div>
              <div>
                <h2 class="text-2xl font-semibold">RAG / Memory</h2>
                <p class="text-sm text-neutral-500">Upload documents to build retrieval memory.</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button
                @click="reindex()"
                :disabled="ragLoading"
                class="px-4 py-2 bg-surface-200 hover:bg-surface-300 rounded-xl text-sm font-medium transition-all duration-300 disabled:opacity-50"
              >
                Reindex
              </button>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Upload -->
            <div class="glass-card rounded-2xl p-6 lg:col-span-1">
              <h3 class="text-lg font-semibold mb-4">Upload Document</h3>
              <input type="file" multiple @change="handleFileSelect" class="w-full text-sm text-neutral-400 file:mr-3 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-surface-200 file:text-neutral-300 file:cursor-pointer">
              <button
                @click="uploadDocument()"
                :disabled="!selectedFiles.length || ragLoading"
                class="mt-4 w-full px-4 py-2 bg-accent-500 hover:bg-accent-600 text-surface rounded-lg text-sm font-semibold transition-all disabled:opacity-50"
              >
                Upload & Embed
              </button>
              <p class="text-xs text-neutral-500 mt-3">Supported: txt, md, pdf, docx (others will be best-effort)</p>
            </div>

            <!-- Documents -->
            <div class="glass-card rounded-2xl p-6 lg:col-span-2">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold">Documents</h3>
                <button @click="loadDocuments()" class="text-xs text-neutral-400 hover:text-neutral-200">Refresh</button>
              </div>
              <template x-if="ragDocuments.length === 0">
                <div class="text-sm text-neutral-500">No documents yet.</div>
              </template>
              <div class="flex items-center justify-between mb-3" x-show="ragDocuments.length > 0">
                <label class="flex items-center gap-2 text-xs text-neutral-400">
                  <input type="checkbox" x-model="useSelectedDocsOnly" class="rounded border-surface-300 bg-surface-200">
                  Search scope: selected docs only
                </label>
              </div>
              <div class="space-y-3" x-show="ragDocuments.length > 0">
                <template x-for="doc in ragDocuments" :key="doc.id">
                  <div class="flex items-center justify-between p-3 rounded-xl bg-surface-200/60">
                    <div>
                      <div class="flex items-center gap-2">
                        <input type="checkbox" :value="doc.id" x-model="selectedDocIds" class="rounded border-surface-300 bg-surface-200">
                        <div class="text-sm font-medium text-neutral-200" x-text="doc.title"></div>
                      </div>
                      <div class="text-xs text-neutral-500" x-text="doc.sourceType + ' Â· ' + (doc.chunkCount || 0) + ' chunks'"></div>
                    </div>
                    <button @click="deleteDocument(doc.id)" class="text-xs text-red-400 hover:text-red-300">Delete</button>
                  </div>
                </template>
              </div>
            </div>
          </div>

          <!-- Memories -->
          <div class="glass-card rounded-2xl p-6 mt-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold">Architecture / DB Memory</h3>
              <button @click="loadMemories()" class="text-xs text-neutral-400 hover:text-neutral-200">Refresh</button>
            </div>
            <template x-if="ragMemories.length === 0">
              <div class="text-sm text-neutral-500">No memory notes yet.</div>
            </template>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" x-show="ragMemories.length > 0">
              <template x-for="mem in ragMemories" :key="mem.id">
                <div class="p-4 rounded-xl bg-surface-200/60">
                  <div class="text-xs uppercase tracking-wide text-accent-400 mb-1" x-text="mem.category"></div>
                  <div class="text-sm font-semibold text-neutral-200 mb-2" x-text="mem.title"></div>
                  <div class="text-xs text-neutral-400 line-clamp-3" x-text="mem.content"></div>
                </div>
              </template>
            </div>
          </div>

          <!-- RAG Test -->
          <div class="glass-card rounded-2xl p-6 mt-6">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold">RAG Test</h3>
            </div>
            <textarea x-model="ragTestQuery" rows="3" placeholder="Ask a question to test retrieval..." class="w-full px-3 py-2 bg-surface-200 rounded-lg border border-surface-300 text-sm focus:outline-none"></textarea>
            <div class="grid grid-cols-2 gap-3 mt-3">
              <input type="number" min="1" x-model.number="ragTestTopK" placeholder="topK (default 4)" class="w-full px-3 py-2 bg-surface-200 rounded-lg border border-surface-300 text-sm focus:outline-none">
              <input type="number" step="0.01" min="0" max="1" x-model.number="ragTestMinScore" placeholder="minScore (default 0.35)" class="w-full px-3 py-2 bg-surface-200 rounded-lg border border-surface-300 text-sm focus:outline-none">
            </div>
            <div class="flex items-center gap-2 mt-3">
              <button
                @click="runRagTest()"
                :disabled="!ragTestQuery.trim() || ragLoading"
                class="px-4 py-2 bg-accent-500 hover:bg-accent-600 text-surface rounded-lg text-sm font-semibold transition-all disabled:opacity-50"
              >
                Run Test
              </button>
            </div>
            <template x-if="ragTestResult">
              <div class="mt-4 space-y-3">
                <div class="text-xs text-neutral-400">Top hits:</div>
                <template x-for="hit in ragTestResult.hits" :key="hit.title + hit.chunkIndex">
                  <div class="p-3 rounded-lg bg-surface-200/60">
                    <div class="text-xs text-accent-400" x-text="hit.title + ' Â· score ' + hit.score.toFixed(3)"></div>
                    <div class="text-xs text-neutral-400 mt-1 line-clamp-3" x-text="hit.snippet"></div>
                  </div>
                </template>
                <div class="text-xs text-neutral-400">Context preview:</div>
                <pre class="text-xs text-neutral-300 whitespace-pre-wrap bg-surface-200/60 p-3 rounded-lg" x-text="ragTestResult.contextPreview"></pre>
              </div>
            </template>
          </div>
        </section>
      </div><!-- END RAG TAB -->

      <!-- README TAB -->
      <div x-show="activeTab === 'readme'" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
        <section class="max-w-3xl mx-auto">
          <!-- External Links -->
          <div class="flex items-center justify-center gap-3 mb-8">
              <a href="https://www.npmjs.com/package/ai-consultation-mcp" target="_blank" rel="noopener noreferrer"
                 class="flex items-center gap-2 px-4 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg text-sm font-medium transition-all">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M0 7.334v8h6.666v1.332H12v-1.332h12v-8H0zm6.666 6.664H5.334v-4H3.999v4H1.335V8.667h5.331v5.331zm4 0v1.336H8.001V8.667h5.334v5.332h-2.669v-.001zm12.001 0h-1.33v-4h-1.336v4h-1.335v-4h-1.33v4h-2.671V8.667h8.002v5.331z"/>
                </svg>
                npm
              </a>
              <a href="https://github.com/menesekinci/ai-consultation-mcp" target="_blank" rel="noopener noreferrer"
                 class="flex items-center gap-2 px-4 py-2 bg-neutral-500/10 hover:bg-neutral-500/20 text-neutral-300 rounded-lg text-sm font-medium transition-all">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                </svg>
                GitHub
              </a>
              <a href="https://x.com/menesekinci_ai" target="_blank" rel="noopener noreferrer"
                 class="flex items-center gap-2 px-4 py-2 bg-sky-500/10 hover:bg-sky-500/20 text-sky-400 rounded-lg text-sm font-medium transition-all">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
                @menesekinci_ai
              </a>
          </div>

          <!-- What is this MCP? -->
          <div class="glass-card rounded-2xl p-6 mb-6">
            <h3 class="text-lg font-semibold text-neutral-100 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-accent-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              What is Agent Consultation MCP?
            </h3>
            <p class="text-neutral-400 text-sm leading-relaxed mb-4">
              This MCP enables AI agents to consult with other AI models during their workflow.
              When an agent faces a complex decision, architectural choice, or debugging challenge,
              it can request a <span class="text-accent-400 font-medium">second opinion</span> from a different model.
            </p>
            <p class="text-neutral-500 text-sm leading-relaxed mb-3">
              Default runtime architecture is <span class="text-neutral-300 font-medium">Daemon + Proxy</span>,
              which enables shared state, real-time sync, and safer multi-client behavior.
            </p>
            <p class="text-neutral-500 text-sm leading-relaxed">
              Legacy mode is still available for compatibility but is deprecated.
            </p>
          </div>

          <!-- Supported Providers -->
          <div class="glass-card rounded-2xl p-6 mb-6">
            <h3 class="text-lg font-semibold text-neutral-100 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-accent-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a4 4 0 00-5.656 0L12 17.2l-1.772-1.772a4 4 0 10-5.656 5.656L12 28.8l7.428-7.716a4 4 0 000-5.656z"/>
              </svg>
              Supported Providers
            </h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <div class="flex items-center gap-3">
                  <span class="text-neutral-200 font-medium text-sm">OpenAI</span>
                  <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">gpt-5.2 / gpt-5.2-pro</code>
                </div>
                <span class="text-xs text-neutral-500">Enabled in current stable scope</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <div class="flex items-center gap-3">
                  <span class="text-neutral-200 font-medium text-sm">DeepSeek</span>
                  <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">deepseek-chat / deepseek-reasoner</code>
                </div>
                <span class="text-xs text-neutral-500">Enabled in current stable scope</span>
              </div>
            </div>
          </div>

          <!-- Recommendations -->
          <div class="glass-card rounded-2xl p-6 mb-6 border border-accent-500/20">
            <h3 class="text-lg font-semibold text-neutral-100 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-accent-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
              </svg>
              Recommended Usage
            </h3>
            <div class="space-y-3">
              <div class="flex items-start gap-3">
                <div class="w-6 h-6 bg-emerald-500/10 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                  <svg class="w-3 h-3 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                </div>
                <p class="text-neutral-400 text-sm"><span class="text-neutral-200 font-medium">Planning Phase:</span> Let agents consult during architecture decisions and implementation planning</p>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-6 h-6 bg-emerald-500/10 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                  <svg class="w-3 h-3 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                </div>
                <p class="text-neutral-400 text-sm"><span class="text-neutral-200 font-medium">Debugging:</span> When stuck on complex bugs, a fresh perspective often reveals the issue</p>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-6 h-6 bg-emerald-500/10 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                  <svg class="w-3 h-3 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                </div>
                <p class="text-neutral-400 text-sm"><span class="text-neutral-200 font-medium">Code Review:</span> Validate implementation choices before committing</p>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-6 h-6 bg-emerald-500/10 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                  <svg class="w-3 h-3 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                </div>
                <p class="text-neutral-400 text-sm"><span class="text-neutral-200 font-medium">Non-intrusive by default:</span> Auto-open Web UI is disabled by default. You can enable it from Configuration when needed.</p>
              </div>
            </div>
          </div>

          <!-- Open Source -->
          <div class="glass-card rounded-2xl p-6 mb-6 bg-gradient-to-br from-surface-50/80 to-surface-100/40">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-accent-500/10 rounded-xl flex items-center justify-center flex-shrink-0">
                <svg class="w-6 h-6 text-accent-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
              </div>
              <div>
                <h4 class="font-semibold text-neutral-100 mb-1">Open Source & Community Driven</h4>
                <p class="text-neutral-500 text-sm">MIT Licensed. Contributions, feature requests, and new provider integrations are welcome!</p>
              </div>
            </div>
          </div>

          <!-- MCP Tools -->
          <div class="glass-card rounded-2xl p-6">
            <h3 class="text-lg font-semibold text-neutral-100 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-accent-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
              </svg>
              Available Tools
            </h3>
            <div class="space-y-3">
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <div class="flex items-center gap-3">
                  <code class="bg-accent-500/20 text-accent-300 px-2 py-1 rounded text-xs font-mono">consult_agent</code>
                  <span class="text-xs text-emerald-400">Primary</span>
                </div>
                <span class="text-xs text-neutral-500">Start a consultation</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">continue_conversation</code>
                <span class="text-xs text-neutral-500">Follow-up messages</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">end_conversation</code>
                <span class="text-xs text-neutral-500">Archive conversation</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <div class="flex items-center gap-3">
                  <code class="bg-accent-500/20 text-accent-300 px-2 py-1 rounded text-xs font-mono">rag_search</code>
                  <span class="text-xs text-emerald-400">RAG</span>
                </div>
                <span class="text-xs text-neutral-500">Semantic document search</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">rag_upload_files</code>
                <span class="text-xs text-neutral-500">Upload local files to index</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">rag_list_docs</code>
                <span class="text-xs text-neutral-500">List indexed documents</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">rag_list_folders</code>
                <span class="text-xs text-neutral-500">List folder namespaces</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">rag_update_doc_folder</code>
                <span class="text-xs text-neutral-500">Move document to folder</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">rag_bulk_update_folders</code>
                <span class="text-xs text-neutral-500">Bulk folder updates</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">rag_list_memories</code>
                <span class="text-xs text-neutral-500">List structured memories</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">rag_add_memory</code>
                <span class="text-xs text-neutral-500">Add memory note</span>
              </div>
              <div class="flex items-center justify-between p-3 bg-surface-50/50 rounded-xl border border-surface-200/30">
                <code class="bg-surface-200 text-neutral-300 px-2 py-1 rounded text-xs font-mono">rag_get_doc_chunks</code>
                <span class="text-xs text-neutral-500">Inspect document chunks</span>
              </div>
            </div>
          </div>
        </section>
      </div><!-- END README TAB -->

      <!-- Footer -->
      <footer class="text-center pt-12 border-t border-surface-200/30 opacity-0 animate-fade-in stagger-4">
        <div class="flex items-center justify-center space-x-2 text-neutral-600">
          <span class="font-mono text-sm">Agent Consultation MCP</span>
          <span class="text-accent-500">â¢</span>
          <span class="font-mono text-sm">v2.1.4</span>
        </div>
        <p class="text-neutral-600 text-sm mt-2">Configuration changes are saved automatically</p>
      </footer>
    </div>

    <!-- API Key Modal -->
    <div
      x-cloak
      x-show="showModal"
      style="display: none;"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4"
      @click.self="closeModal()"
    >
      <div
        x-show="showModal"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 scale-90 translate-y-4"
        x-transition:enter-end="opacity-100 scale-100 translate-y-0"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100 scale-100"
        x-transition:leave-end="opacity-0 scale-90"
        class="glass-card rounded-2xl max-w-md w-full p-8 border border-surface-300/50"
      >
        <div class="flex items-center mb-6">
          <div class="w-12 h-12 bg-accent-500/10 rounded-xl flex items-center justify-center mr-4">
            <svg class="w-6 h-6 text-accent-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"/>
            </svg>
          </div>
          <div>
            <h3 class="text-xl font-semibold text-neutral-100" x-text="'Configure ' + (modalProvider?.name || '')"></h3>
            <p class="text-sm text-neutral-500">Enter your API key below</p>
          </div>
        </div>

        <div class="space-y-5">
          <div>
            <label class="block text-sm font-medium text-neutral-300 mb-2">API Key</label>
            <input
              type="password"
              x-model="modalApiKey"
              @keyup.enter="saveKey()"
              placeholder="sk-..."
              class="w-full bg-surface-100 border border-surface-300 rounded-xl px-4 py-3 text-neutral-100 placeholder-neutral-600 focus:ring-2 focus:ring-accent-500/50 focus:border-accent-500 transition-all duration-300 font-mono text-sm"
            />
            <p class="text-xs text-neutral-600 mt-2 flex items-center">
              <svg class="w-3 h-3 mr-1 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
              Encrypted with AES-256-GCM before storage
            </p>
          </div>

          <div class="flex gap-3 pt-2">
            <button
              @click="saveKey()"
              :disabled="!modalApiKey || saving"
              class="flex-1 px-5 py-3 bg-accent-600 hover:bg-accent-500 rounded-xl font-semibold transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed btn-accent"
            >
              <span x-show="!saving">Save Key</span>
              <span x-show="saving" class="flex items-center justify-center">
                <svg class="animate-spin h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Saving...
              </span>
            </button>
            <button
              @click="testKeyModal()"
              :disabled="!modalApiKey || testingModal"
              class="px-5 py-3 bg-surface-200 hover:bg-surface-300 rounded-xl font-medium transition-all duration-300 disabled:opacity-50"
            >
              <span x-show="!testingModal">Test</span>
              <span x-show="testingModal">
                <svg class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </span>
            </button>
            <button
              @click="closeModal()"
              class="px-5 py-3 bg-surface-200 hover:bg-surface-300 rounded-xl font-medium transition-all duration-300"
            >
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Conversation Detail Modal -->
    <div
      x-cloak
      x-show="showConversationModal"
      style="display: none;"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
      @click.self="closeConversationModal()"
      @keydown.escape.window="closeConversationModal()"
    >
      <div
        x-show="showConversationModal"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 scale-90 translate-y-4"
        x-transition:enter-end="opacity-100 scale-100 translate-y-0"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100 scale-100"
        x-transition:leave-end="opacity-0 scale-90"
        class="glass-card rounded-2xl w-full max-w-3xl max-h-[85vh] flex flex-col border border-surface-300/50"
      >
        <!-- Modal Header -->
        <div class="flex items-center justify-between p-5 border-b border-surface-300/30 shrink-0">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-accent-500/10 rounded-xl flex items-center justify-center">
              <svg class="w-5 h-5 text-accent-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
            </div>
            <div>
              <h3 class="text-lg font-semibold text-neutral-100">Conversation Details</h3>
              <div class="flex items-center gap-2 mt-1">
                <template x-if="selectedConversation">
                  <span
                    class="px-2 py-0.5 rounded text-[10px] font-semibold uppercase"
                    :class="selectedConversation.status === 'active'
                      ? 'bg-emerald-500/20 text-emerald-400'
                      : 'bg-neutral-500/20 text-neutral-400'"
                    x-text="selectedConversation.status"
                  ></span>
                </template>
                <template x-if="selectedConversation">
                  <span class="px-2 py-0.5 bg-accent-500/15 text-accent-400 rounded text-xs font-mono" x-text="selectedConversation.model"></span>
                </template>
                <template x-if="selectedConversation">
                  <span class="text-xs text-neutral-500" x-text="selectedConversation.messageCount + ' messages'"></span>
                </template>
              </div>
            </div>
          </div>
          <button
            @click="closeConversationModal()"
            class="w-10 h-10 bg-surface-200 hover:bg-surface-300 rounded-xl flex items-center justify-center transition-all duration-200"
          >
            <svg class="w-5 h-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <!-- Modal Body - Scrollable Messages -->
        <div class="flex-1 overflow-y-auto p-5 space-y-4">
          <template x-if="selectedConversation">
            <template x-for="msg in selectedConversation.messages" :key="msg.id">
              <div class="flex" :class="msg.role === 'user' ? 'justify-end' : 'justify-start'">
                <div
                  class="max-w-[85%] rounded-xl px-4 py-3"
                  :class="msg.role === 'user'
                    ? 'bg-accent-600/20 text-neutral-100 border border-accent-500/30'
                    : 'bg-surface-200/50 text-neutral-200 border border-surface-300/30'"
                >
                  <div class="flex items-center mb-2">
                    <div
                      class="w-6 h-6 rounded-lg flex items-center justify-center mr-2"
                      :class="msg.role === 'user' ? 'bg-accent-500/30' : 'bg-emerald-500/30'"
                    >
                      <template x-if="msg.role === 'user'">
                        <svg class="w-3.5 h-3.5 text-accent-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                      </template>
                      <template x-if="msg.role !== 'user'">
                        <svg class="w-3.5 h-3.5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                      </template>
                    </div>
                    <span class="text-xs font-semibold" :class="msg.role === 'user' ? 'text-accent-400' : 'text-emerald-400'" x-text="msg.role === 'user' ? 'Agent' : selectedConversation?.model || 'AI'"></span>
                  </div>
                  <div class="text-sm whitespace-pre-wrap break-words leading-relaxed" x-text="msg.content"></div>
                </div>
              </div>
            </template>
          </template>
        </div>

        <!-- Modal Footer -->
        <div class="p-4 border-t border-surface-300/30 shrink-0">
          <template x-if="selectedConversation">
            <div class="flex items-center justify-between text-xs text-neutral-500">
              <code class="font-mono bg-surface-200/50 px-2 py-1 rounded" x-text="'ID: ' + selectedConversation.id"></code>
              <div class="flex items-center gap-3">
                <span x-text="'Created: ' + new Date(selectedConversation.createdAt).toLocaleString()"></span>
                <template x-if="selectedConversation.status === 'archived' && selectedConversation.endedAt">
                  <span x-text="'Ended: ' + new Date(selectedConversation.endedAt).toLocaleString()"></span>
                </template>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>
  </div>

  <script>
    function configApp() {
      return {
        loading: true,
        loadError: null,
        providers: [],
        config: {
          defaultModel: '',
          maxMessages: 5,
          requestTimeout: 180000,
          autoOpenWebUI: false,
          availableModels: [],
        },
        toasts: [],
        showModal: false,
        modalProvider: null,
        modalApiKey: '',
        saving: false,
        testing: null,
        testingModal: false,
        chatHistory: [],
        loadingHistory: false,
        historyStats: { active: 0, archived: 0 },
        // Tab navigation
        activeTab: 'config',
        // Pagination state
        currentPage: 1,
        itemsPerPage: 10,
        // Conversation detail modal
        selectedConversation: null,
        showConversationModal: false,
        // RAG state
        ragDocuments: [],
        ragMemories: [],
        ragLoading: false,
        selectedFiles: [],
        selectedDocIds: [],
        useSelectedDocsOnly: true,
        ragTestQuery: '',
        ragTestResult: null,
        ragTestTopK: 4,
        ragTestMinScore: 0.35,
        // Socket.io for real-time updates
        socket: null,
        connected: false,
        hasShownConnectedToast: false,
        clientCount: 0,
        socketDisabled: false,
        // Flag to prevent duplicate toasts when saving config
        _savingConfig: false,
        _configSaveInFlight: false,
        _configSaveQueued: false,
        _lastSavedConfigHash: '',
        _recentToastAt: {},

        // Computed: total pages
        get totalPages() {
          return Math.ceil(this.chatHistory.length / this.itemsPerPage) || 1;
        },

        // Computed: paginated history
        get paginatedHistory() {
          const start = (this.currentPage - 1) * this.itemsPerPage;
          const end = start + this.itemsPerPage;
          return this.chatHistory.slice(start, end);
        },

        // Pagination methods
        goToPage(page) {
          if (page >= 1 && page <= this.totalPages) {
            this.currentPage = page;
          }
        },
        nextPage() {
          if (this.currentPage < this.totalPages) {
            this.currentPage++;
          }
        },
        prevPage() {
          if (this.currentPage > 1) {
            this.currentPage--;
          }
        },

        // Conversation modal methods
        openConversationModal(conv) {
          this.selectedConversation = conv;
          this.showConversationModal = true;
          document.body.style.overflow = 'hidden';
        },
        closeConversationModal() {
          this.showConversationModal = false;
          this.selectedConversation = null;
          document.body.style.overflow = '';
        },

        // Delete a single conversation
        async deleteConversation(id) {
          if (!confirm('Are you sure you want to delete this conversation? This cannot be undone.')) {
            return;
          }

          try {
            const success = await this.deleteConversationRemote(id);
            if (!success) {
              this.showToast('Failed to delete conversation', 'error');
              return;
            }
            this.showToast('Conversation deleted', 'success');
            this.chatHistory = this.chatHistory.filter(c => c.id !== id);
            this.historyStats.archived = Math.max(0, this.historyStats.archived - 1);
          } catch (error) {
            this.showToast('Failed to delete conversation: ' + error.message, 'error');
          }
        },

        // Delete all archived conversations
        async deleteAllArchived() {
          const archivedCount = this.historyStats.archived;
          if (!confirm(`Are you sure you want to delete all ${archivedCount} archived conversations? This cannot be undone.`)) {
            return;
          }

          try {
            const archivedConvs = this.chatHistory.filter(c => c.status === 'archived');
            const result = await this.deleteArchivedRemote(archivedConvs.map(c => c.id));
            if (result.deleted > 0) {
              this.chatHistory = this.chatHistory.filter(c => c.status !== 'archived');
              this.historyStats.archived = 0;
              this.showToast(`Deleted ${result.deleted} archived conversations`, 'success');
            } else {
              this.showToast('No archived conversations were deleted', 'info');
            }
          } catch (error) {
            this.showToast('Failed to delete archived conversations: ' + error.message, 'error');
          }
        },

        deleteConversationSocket(id) {
          return new Promise((resolve) => {
            this.socket.emit('conversation:delete', id, (success) => {
              resolve(Boolean(success));
            });
          });
        },

        async deleteConversationHttp(id) {
          const res = await fetch(`/api/chat/${id}`, { method: 'DELETE' });
          if (res.ok) return true;
          if (res.status === 404) return false;
          const data = await res.json().catch(() => ({}));
          throw new Error(data.message || data.error || 'Delete request failed');
        },

        async deleteConversationRemote(id) {
          if (this.socket?.connected) {
            return await this.deleteConversationSocket(id);
          }
          return await this.deleteConversationHttp(id);
        },

        async deleteArchivedRemote(ids) {
          // Prefer socket path when connected for realtime sync
          if (this.socket?.connected) {
            const results = await Promise.all(ids.map((id) => this.deleteConversationSocket(id)));
            return { deleted: results.filter(Boolean).length };
          }

          // HTTP bulk endpoint fallback
          const bulkRes = await fetch('/api/chat/archived/all', { method: 'DELETE' });
          if (bulkRes.ok) {
            const data = await bulkRes.json();
            return { deleted: Number(data.deleted) || 0 };
          }

          // Final fallback: per-item HTTP deletes
          let deleted = 0;
          for (const id of ids) {
            const ok = await this.deleteConversationHttp(id);
            if (ok) deleted++;
          }
          return { deleted };
        },

        handleFileSelect(event) {
          this.selectedFiles = Array.from(event.target.files || []);
        },

        async uploadDocument() {
          if (!this.selectedFiles.length) return;
          this.ragLoading = true;
          try {
            const formData = new FormData();
            this.selectedFiles.forEach((file) => {
              formData.append('files', file);
            });
            const res = await fetch('/api/rag/upload', { method: 'POST', body: formData });
            if (!res.ok) {
              const data = await res.json();
              throw new Error(data.message || 'Upload failed');
            }
            this.showToast('Document uploaded and embedded', 'success');
            this.selectedFiles = [];
            await this.loadDocuments();
          } catch (error) {
            this.showToast('Upload failed: ' + error.message, 'error');
          } finally {
            this.ragLoading = false;
          }
        },

        async loadDocuments() {
          try {
            const res = await fetch('/api/rag/documents');
            if (!res.ok) throw new Error('Failed to load documents');
            const data = await res.json();
            this.ragDocuments = data.documents || [];
          } catch (error) {
            console.error('Failed to load documents:', error);
          }
        },

        async deleteDocument(id) {
          if (!confirm('Delete this document and all embeddings?')) return;
          try {
            const res = await fetch(`/api/rag/documents/${id}`, { method: 'DELETE' });
            if (!res.ok) throw new Error('Delete failed');
            this.showToast('Document deleted', 'success');
            await this.loadDocuments();
          } catch (error) {
            this.showToast('Delete failed: ' + error.message, 'error');
          }
        },

        async reindex() {
          this.ragLoading = true;
          try {
            const res = await fetch('/api/rag/reindex', { method: 'POST' });
            if (!res.ok) {
              const data = await res.json();
              throw new Error(data.message || 'Reindex failed');
            }
            this.showToast('Reindex completed', 'success');
          } catch (error) {
            this.showToast('Reindex failed: ' + error.message, 'error');
          } finally {
            this.ragLoading = false;
          }
        },

        async loadMemories() {
          try {
            const res = await fetch('/api/rag/memories');
            if (!res.ok) throw new Error('Failed to load memories');
            const data = await res.json();
            this.ragMemories = data.memories || [];
          } catch (error) {
            console.error('Failed to load memories:', error);
          }
        },

        async runRagTest() {
          if (!this.ragTestQuery.trim()) return;
          this.ragLoading = true;
          try {
            const body = {
              query: this.ragTestQuery,
              topK: this.ragTestTopK,
              minScore: this.ragTestMinScore,
            };
            if (this.useSelectedDocsOnly && this.selectedDocIds.length) {
              body.docIds = this.selectedDocIds;
            }

            const res = await fetch('/api/rag/search', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(body),
            });
            if (!res.ok) {
              const data = await res.json();
              throw new Error(data.message || 'RAG test failed');
            }
            const data = await res.json();
            this.ragTestResult = data;
          } catch (error) {
            this.showToast('RAG test failed: ' + error.message, 'error');
          } finally {
            this.ragLoading = false;
          }
        },

        async init() {
          try {
            // Connect to daemon via WebSocket if available
            const socketAvailable = await this.canUseSocket();
            if (socketAvailable) {
              this.connectSocket();
            } else {
              this.socketDisabled = true;
            }

            await this.loadData();
            // Also load chat history on init
            this.loadChatHistory();
            this.loadDocuments();
            this.loadMemories();
          } catch (error) {
            console.error('Init failed:', error);
            this.loadError = error.message || 'Failed to initialize';
          } finally {
            this.loading = false;
          }
        },

        // Socket.io connection and event handling
        async canUseSocket() {
          try {
            const res = await fetch('/socket.io/?EIO=4&transport=polling');
            return res.status !== 404;
          } catch {
            return false;
          }
        },

        connectSocket() {
          if (this.socketDisabled) return;
          try {
            this.socket = io(window.location.origin, {
              transports: ['websocket'],
              reconnection: true,
              reconnectionDelay: 1000,
              reconnectionAttempts: 10,
              query: { type: 'webui' },
            });

            this.socket.on('connect', () => {
              console.log('[WebUI] Connected to daemon');
              this.connected = true;
              if (!this.hasShownConnectedToast) {
                this.hasShownConnectedToast = true;
                this.showToast('Connected to server', 'success');
              }
            });

            this.socket.on('disconnect', (reason) => {
              console.log('[WebUI] Disconnected:', reason);
              this.connected = false;
              if (reason !== 'io client disconnect') {
                this.showToast('Disconnected from server', 'error');
              }
            });

            this.socket.on('connect_error', (err) => {
              console.error('[WebUI] Connection error:', err);
              this.connected = false;
            });

            // Real-time conversation events
            this.socket.on('conversation:created', (conv) => {
              console.log('[WebUI] New conversation:', conv.id);
              this.loadChatHistory(); // Refresh the list
              this.showToast('New conversation started', 'info');
            });

            this.socket.on('conversation:message', (data) => {
              console.log('[WebUI] New message in:', data.conversationId);
              // Update conversation in history if visible
              const conv = this.chatHistory.find(c => c.id === data.conversationId);
              if (conv) {
                conv.messages = conv.messages || [];
                // Check for duplicate before pushing
                const exists = conv.messages.some(m => m.id === data.message.id);
                if (!exists) {
                  conv.messages.push(data.message);
                  conv.messageCount = conv.messages.length;
                }
              }
              // Update selected conversation if open
              if (this.selectedConversation?.id === data.conversationId) {
                this.selectedConversation.messages = this.selectedConversation.messages || [];
                const exists = this.selectedConversation.messages.some(m => m.id === data.message.id);
                if (!exists) {
                  this.selectedConversation.messages.push(data.message);
                }
              }
            });

            this.socket.on('conversation:ended', (data) => {
              console.log('[WebUI] Conversation ended:', data.conversationId);
              this.loadChatHistory(); // Refresh to move to archived
              this.showToast('Conversation archived', 'info');
            });

            this.socket.on('conversation:deleted', (data) => {
              console.log('[WebUI] Conversation deleted:', data.conversationId);
              this.chatHistory = this.chatHistory.filter(c => c.id !== data.conversationId);
              if (this.selectedConversation?.id === data.conversationId) {
                this.closeConversationModal();
              }
            });

            this.socket.on('config:updated', (config) => {
              console.log('[WebUI] Config updated from another client');
              // Only refresh if change came from another client (not our own save)
              // We'll use a flag to prevent duplicate toasts
              if (!this._savingConfig) {
                this.loadData(); // Refresh config
                this.showToast('Configuration updated', 'info');
              }
            });

            this.socket.on('clients:count', (count) => {
              this.clientCount = count;
            });

          } catch (err) {
            console.error('[WebUI] Failed to connect:', err);
          }
        },

        async loadData() {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 10000);

          try {
            const [providersRes, configRes] = await Promise.all([
              fetch('/api/providers', { signal: controller.signal }),
              fetch('/api/config', { signal: controller.signal }),
            ]);

            if (!providersRes.ok) {
              const errorText = await providersRes.text();
              throw new Error(`Providers API failed (${providersRes.status}): ${errorText}`);
            }
            if (!configRes.ok) {
              const errorText = await configRes.text();
              throw new Error(`Config API failed (${configRes.status}): ${errorText}`);
            }

            this.providers = await providersRes.json();
            const loadedConfig = await configRes.json();
            // Ensure autoOpenWebUI has a default value if not present
            this.config = {
              ...loadedConfig,
              autoOpenWebUI: loadedConfig.autoOpenWebUI !== undefined ? loadedConfig.autoOpenWebUI : false,
            };
            this._lastSavedConfigHash = JSON.stringify({
              defaultModel: this.config.defaultModel,
              maxMessages: parseInt(this.config.maxMessages, 10),
              requestTimeout: parseInt(this.config.requestTimeout, 10),
              autoOpenWebUI: this.config.autoOpenWebUI,
            });
            this.loadError = null;
          } catch (error) {
            console.error('loadData error:', error);
            if (error.name === 'AbortError') {
              this.showToast('Request timed out. Is the server running?', 'error');
              throw new Error('Request timed out');
            }
            this.showToast('Failed to load: ' + error.message, 'error');
            throw error;
          } finally {
            clearTimeout(timeoutId);
          }
        },

        async saveConfig() {
          const payload = {
            defaultModel: this.config.defaultModel,
            maxMessages: parseInt(this.config.maxMessages, 10),
            requestTimeout: parseInt(this.config.requestTimeout, 10),
            autoOpenWebUI: this.config.autoOpenWebUI,
          };
          const payloadHash = JSON.stringify(payload);

          // No-op for unchanged settings
          if (payloadHash === this._lastSavedConfigHash) {
            return;
          }

          // Collapse rapid changes into at most one queued request
          if (this._configSaveInFlight) {
            this._configSaveQueued = true;
            return;
          }

          this._savingConfig = true;
          this._configSaveInFlight = true;
          try {
            const res = await fetch('/api/config', {
              method: 'PATCH',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload),
            });

            if (!res.ok) {
              const data = await res.json();
              throw new Error(data.message || 'Failed to save');
            }

            this._lastSavedConfigHash = payloadHash;
            this.showToast('Settings saved', 'success');
          } catch (error) {
            this.showToast('Failed to save settings: ' + error.message, 'error');
          } finally {
            // Reset flag after a short delay to allow socket event to be ignored
            setTimeout(() => { this._savingConfig = false; }, 500);
            this._configSaveInFlight = false;
            if (this._configSaveQueued) {
              this._configSaveQueued = false;
              setTimeout(() => this.saveConfig(), 0);
            }
          }
        },

        openKeyModal(provider) {
          this.modalProvider = provider;
          this.modalApiKey = '';
          this.showModal = true;
        },

        closeModal() {
          this.showModal = false;
          this.modalProvider = null;
          this.modalApiKey = '';
        },

        async saveKey() {
          if (!this.modalApiKey || !this.modalProvider) return;

          this.saving = true;
          try {
            const res = await fetch(`/api/providers/${this.modalProvider.id}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ apiKey: this.modalApiKey }),
            });

            if (!res.ok) {
              const data = await res.json();
              throw new Error(data.message || 'Failed to save');
            }

            this.showToast(`${this.modalProvider.name} API key saved`, 'success');
            this.closeModal();
            await this.loadData();
          } catch (error) {
            this.showToast('Failed to save API key: ' + error.message, 'error');
          } finally {
            this.saving = false;
          }
        },

        async testKey(providerId) {
          this.testing = providerId;
          try {
            const res = await fetch(`/api/providers/${providerId}/test`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({}),
            });

            const data = await res.json();
            if (data.valid) {
              this.showToast(data.message, 'success');
            } else {
              this.showToast(data.message, 'error');
            }
          } catch (error) {
            this.showToast('Test failed: ' + error.message, 'error');
          } finally {
            this.testing = null;
          }
        },

        async testKeyModal() {
          if (!this.modalApiKey || !this.modalProvider) return;

          this.testingModal = true;
          try {
            const res = await fetch(`/api/providers/${this.modalProvider.id}/test`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ apiKey: this.modalApiKey }),
            });

            const data = await res.json();
            if (data.valid) {
              this.showToast(data.message, 'success');
            } else {
              this.showToast(data.message, 'error');
            }
          } catch (error) {
            this.showToast('Test failed: ' + error.message, 'error');
          } finally {
            this.testingModal = false;
          }
        },

        async removeKey(providerId) {
          if (!confirm('Are you sure you want to remove this API key?')) return;

          try {
            const res = await fetch(`/api/providers/${providerId}`, {
              method: 'DELETE',
            });

            if (!res.ok) {
              const data = await res.json();
              throw new Error(data.message || 'Failed to remove');
            }

            this.showToast('API key removed', 'success');
            await this.loadData();
          } catch (error) {
            this.showToast('Failed to remove API key: ' + error.message, 'error');
          }
        },

        showToast(message, type = 'info', options = {}) {
          const dedupe = options.dedupe !== false;
          const dedupeWindowMs = options.dedupeWindowMs ?? 1200;
          const dedupeKey = `${type}:${message}`;
          const now = Date.now();
          const lastShownAt = this._recentToastAt[dedupeKey] || 0;
          if (dedupe && now - lastShownAt < dedupeWindowMs) {
            return;
          }
          this._recentToastAt[dedupeKey] = now;

          const id = Date.now() + Math.floor(Math.random() * 1000);
          const toast = { id, message, type, show: true };
          this.toasts.push(toast);

          setTimeout(() => {
            toast.show = false;
            setTimeout(() => {
              this.toasts = this.toasts.filter((t) => t.id !== id);
            }, 200);
          }, 3000);
        },

        async loadChatHistory() {
          this.loadingHistory = true;
          this.currentPage = 1;  // Reset to first page on refresh
          try {
            const res = await fetch('/api/chat/history');
            if (!res.ok) {
              throw new Error('Failed to fetch history');
            }
            const data = await res.json();
            // Combine active and archived conversations
            const allConversations = [
              ...(data.active || []).map(c => ({ ...c, status: 'active' })),
              ...(data.archived || []).map(c => ({ ...c, status: 'archived' })),
            ];
            // Sort by updatedAt descending
            allConversations.sort((a, b) => new Date(b.updatedAt || b.createdAt) - new Date(a.updatedAt || a.createdAt));
            this.chatHistory = allConversations;
            this.historyStats = {
              active: data.activeCount || 0,
              archived: data.archivedCount || 0,
            };
            // Update selectedConversation if it's open (to keep it in sync)
            if (this.selectedConversation) {
              const updated = allConversations.find(c => c.id === this.selectedConversation.id);
              if (updated) {
                this.selectedConversation = updated;
              }
            }
          } catch (error) {
            console.error('Failed to load chat history:', error);
            // Silent fail - don't show error toast for history
          } finally {
            this.loadingHistory = false;
          }
        },
      };
    }
  </script>
</body>
</html>
